---
title: Kernel Density Estimation of Point Processes in Network Space in R
author: Michael Branion-Calles
date: '2020-10-21'
slug: []
categories:
  - R
  - sf
  - igraph
  - tidygraph
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-10-21T18:27:50-07:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: yes
projects: []
---



<p>To produce kernel density estimates (KDE) of point processes in a linear network:</p>
<p><span class="math display">\[\lambda(z)= \sum_{i=1}^{n} \frac{1}{\tau} k(\frac{d_{iz}}{\tau})y_i\]</span></p>
<p>Using the Quartic function:</p>
<p><span class="math display">\[\lambda(z)= \sum_{i=1}^{n} \frac{1}{\tau}(\frac{3}{\pi}(1-\frac{d_{iz}^2}{\tau^2}))y_i\]</span></p>
<p>Where,</p>
<p><span class="math inline">\(\lambda\)</span>(z) = density at location z;</p>
<p><span class="math inline">\(\tau\)</span> is bandwidth linear network distance;</p>
<p><span class="math inline">\(k\)</span> is the kernel function, typically a function of the ratio of <span class="math inline">\(d_{iz}\)</span> to <span class="math inline">\(\tau\)</span>;</p>
<p><span class="math inline">\(d_{iz}\)</span> is the linear network distance from event <span class="math inline">\(i\)</span> to location <span class="math inline">\(z\)</span>.</p>
<p>I wanted to implement a network-based KDE in R based on the algorithm outlined in <a href="https://www.sciencedirect.com/science/article/pii/S0198971508000318">Xie &amp; Yan (2008)</a>. The network KDE is a a 1-D version of the planar kernel density estimator, with <span class="math inline">\(\tau\)</span> (bandwidth) based on network distances, rather than Euclidean distances and the output is based on <em>lixels</em>, a 1-D version of pixels), rather than pixels across 2-D euclidean space.</p>
<p>In this post I use data from Vancouver, BC as a case study for implementing a network kernel density estimator of points in a network in R.</p>
<p>#Set Up</p>
<pre class="r"><code>library(tidygraph)
library(igraph)
library(stplanr)
library(cancensus)
library(osmdata)
library(dplyr)
library(sf)
library(ggplot2)
library(stringr)</code></pre>
<div id="loading-data" class="section level1">
<h1>Loading Data</h1>
<div id="study-area-extent" class="section level2">
<h2>Study Area Extent</h2>
<p>The first step is to load example data.</p>
<p>I use the <code>get_census</code> function from the <a href="https://mountainmath.github.io/cancensus/index.html"><code>cancensus</code></a> package to extract a <code>sf</code> object with <code>POLYGON</code> geometries, representing the study extent: the City of Vancouver.</p>
<pre class="r"><code>study_area &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CSD=&quot;5915&quot;),
                     level=&#39;CSD&#39;, use_cache = FALSE,geo_format = &quot;sf&quot;) %&gt;%
  filter(name==&quot;Vancouver (CY)&quot;) %&gt;%
  st_transform(crs = 26910) </code></pre>
<pre><code>## 
Downloading: 12 kB     
Downloading: 12 kB     
Downloading: 28 kB     
Downloading: 28 kB     
Downloading: 32 kB     
Downloading: 32 kB     
Downloading: 36 kB     
Downloading: 36 kB     
Downloading: 40 kB     
Downloading: 40 kB     
Downloading: 40 kB     
Downloading: 40 kB     
Downloading: 52 kB     
Downloading: 52 kB     
Downloading: 52 kB     
Downloading: 52 kB</code></pre>
<pre class="r"><code>ggplot(study_area) +
  geom_sf() + 
  coord_sf() +
  theme_void()</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="road-network-data" class="section level2">
<h2>Road Network Data</h2>
<p>Next I use the <code>osmdata</code> package to download street network files for the City of Vancouver. The <code>getbb()</code> function defines a bounding box for the City of Vancouver.</p>
<pre class="r"><code>bbx &lt;- getbb(&quot;Vancouver, BC&quot;)</code></pre>
<p>Next we use the <code>opq()</code> and <code>add_osm_feature</code> functions to obtain open street map road network data. The <code>osmdata_sf()</code></p>
<pre class="r"><code>streets &lt;- bbx %&gt;%
  opq()%&gt;%
  add_osm_feature(key = &quot;highway&quot;, 
                  value=c(&quot;residential&quot;, &quot;living_street&quot;,
                            &quot;service&quot;,&quot;unclassified&quot;,
                            &quot;pedestrian&quot;, &quot;footway&quot;,
                            &quot;track&quot;,&quot;path&quot;,&quot;motorway&quot;, &quot;trunk&quot;,
                          &quot;primary&quot;,&quot;secondary&quot;, 
                          &quot;tertiary&quot;,&quot;motorway_link&quot;,
                          &quot;trunk_link&quot;,&quot;primary_link&quot;,
                          &quot;secondary_link&quot;,
                          &quot;tertiary_link&quot;)) %&gt;%
  osmdata_sf()
  
  
streets_sf &lt;- st_transform(streets$osm_lines,crs=26910) %&gt;% 
  filter(st_intersects(.,study_area,sparse=FALSE))

ggplot() +
  geom_sf(data = streets_sf,
          aes(color=highway),
          size = .4,
          alpha = .65)+
  theme_void()</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="police-report-data" class="section level2">
<h2>Police Report Data</h2>
<p>Finally I get point data of police reports in Vancouver from the City of Vancouver. I subset the data to only include vehicle collisions reported to police in 2018.</p>
<pre class="r"><code>url &lt;- &quot;ftp://webftp.vancouver.ca/opendata/csv/crime_csv_all_years.zip&quot;
temp &lt;- tempfile()
download.file(url, temp)
crime &lt;- read.csv(unz(temp, &quot;crime_csv_all_years.csv&quot;))
unlink(temp)

collisions &lt;- crime %&gt;% 
  filter(YEAR==2018 &amp; str_detect(TYPE,&quot;Vehicle Collision&quot;))%&gt;% 
  st_as_sf(.,coords = c(&quot;X&quot;,&quot;Y&quot;),crs=26910)

ggplot(collisions) +
  geom_sf() + 
  coord_sf()</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Now we have the data we need to try and estimate the density of police-reported collisions or “hotspots” in the City of Vancouver.</p>
</div>
</div>
<div id="prepare-the-network-data" class="section level1">
<h1>Prepare the network data</h1>
<p>First we need to split the network into <em>lixels</em>. <em>Lixels</em> are the 1-dimensional version of a pixel. Essentially I need to set the output resolution of density estimates along the network.</p>
<p>To do so I have two functions <code>split_lines()</code> and <code>lixelize network</code>.</p>
<p>The <code>split_lines()</code> function has three arguments:</p>
<ul>
<li><strong>input_lines</strong>: <code>sf</code> object with <code>LINSETRING</code> or <code>MULTILINESTRING</code> geometry</li>
<li><strong>max_length</strong>: the <em>lixel</em> size, defined by the maximum length of an individual linestring in the data.</li>
<li><strong>id</strong>: a unique id for each line segment in the <code>sf</code> object</li>
</ul>
<p>The <code>split_lines()</code> function is given below:</p>
<pre class="r"><code>split_lines &lt;- function(input_lines, max_length, id) {

  input_lines &lt;- input_lines %&gt;% ungroup()

  geom_column &lt;- attr(input_lines, &quot;sf_column&quot;)

  input_crs &lt;- sf::st_crs(input_lines)

  input_lines[[&quot;geom_len&quot;]] &lt;- sf::st_length(input_lines[[geom_column]])

  attr(input_lines[[&quot;geom_len&quot;]], &quot;units&quot;) &lt;- NULL
  input_lines[[&quot;geom_len&quot;]] &lt;- as.numeric(input_lines[[&quot;geom_len&quot;]])

  too_short &lt;- filter(select(all_of(input_lines),all_of(id), all_of(geom_column), geom_len), geom_len &lt; max_length) %&gt;% select(-geom_len)

  too_long &lt;- filter(select(all_of(input_lines),all_of(id), all_of(geom_column), geom_len), geom_len &gt;= max_length)

  rm(input_lines) # just to control memory usage in case this is big.

  too_long &lt;- mutate(too_long,
                     pieces = ceiling(geom_len / max_length),
                     fID = 1:nrow(too_long)) %&gt;%
    select(-geom_len)

  split_points &lt;- sf::st_set_geometry(too_long, NULL)[rep(seq_len(nrow(too_long)), too_long[[&quot;pieces&quot;]]),] %&gt;%
    select(-pieces)

  split_points &lt;- mutate(split_points, split_fID = row.names(split_points)) %&gt;%
    group_by(fID) %&gt;%
    mutate(piece = 1:n()) %&gt;%
    mutate(start = (piece - 1) / n(),
           end = piece / n()) %&gt;%
    ungroup()

  new_line &lt;- function(i, f, t) {
    lwgeom::st_linesubstring(x = too_long[[geom_column]][i], from = f, to = t)[[1]]
  }

  split_lines &lt;- apply(split_points[c(&quot;fID&quot;, &quot;start&quot;, &quot;end&quot;)], 1,
                       function(x) new_line(i = x[[&quot;fID&quot;]], f = x[[&quot;start&quot;]], t = x[[&quot;end&quot;]]))

  rm(too_long)

  split_lines &lt;- st_sf(split_points[c(id)], geometry = st_sfc(split_lines, crs = input_crs))

  lixel &lt;- rbind(split_lines,too_short) %&gt;% mutate(LIXID = row_number())

  return(lixel)
}</code></pre>
<p>The second function needed to prepare the network data is the <code>lixelize_network</code> function. This takes two arguments, an <code>sf</code> object with <code>linest</code> and the lixel_length argument. This function will create two lixel networks: 1) the output network where the line data are <em>lixelized</em> and no segment is larger than the a given pixel size and 2) a shortest distance network which will be used to calculate road network lengths in our network kernel density estimates that we will dive into shortly. The lixelize network function is given below:</p>
<pre class="r"><code>lixelize_network &lt;- function(sf_network,max_lixel_length,uid){
  print(&quot;Splitting input spatial lines by lixel length...&quot;)
  target_lixel &lt;- split_lines(input_lines = sf_network,max_length = max_lixel_length,id = uid)
  print(&quot;Create corresponding shortest distance network...&quot;)
  shortest_distance_network &lt;- split_lines(input_lines = target_lixel,max_length = max_lixel_length/2,id = uid)
  return(list(target_lixel=target_lixel,shortest_distance_network=shortest_distance_network))
}</code></pre>
<p>To prepare our network data we will first clean the network using the <code>stplanr</code> package to remove road segments unconnected to the broader road network. First we convert our sf object to a spatial lines network object using the <code>SpatialLinesNetwork()</code> function. This will enable us to isolate the largest set of connected line segments within our dataset (e.g. remove a stranded set of road segments not connected to the larger network. )</p>
<pre class="r"><code>network_sln &lt;- SpatialLinesNetwork(streets_sf)</code></pre>
<pre><code>## Warning in SpatialLinesNetwork.sf(streets_sf): Graph composed of multiple
## subgraphs, consider cleaning it with sln_clean_graph().</code></pre>
<pre class="r"><code>network_sln &lt;- sln_clean_graph(network_sln)# Remove unconnected roads</code></pre>
<pre><code>## Input sln composed of 7624 graphs. Selecting the largest.</code></pre>
<pre class="r"><code>ggplot(network_sln@sl) +
  geom_sf() + 
  coord_sf()</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>We use the cleaned <code>sf</code> object going forward in our analysis as our road network data.</p>
<pre class="r"><code>network_sln@sl</code></pre>
<pre><code>## Simple feature collection with 7400 features and 221 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 482364.1 ymin: 5449003 xmax: 498834.3 ymax: 5463459
## projected CRS:  NAD83 / UTM zone 10N
## First 10 features:
##          osm_id                    name Note2 access addr.city addr.housenumber
## 4231647 4231647 West King Edward Avenue  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4231648 4231648        Granville Street  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4231651 4231651        East 12th Avenue  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4231652 4231652 South Grandview Highway  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4241338 4241338           East Broadway  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4254278 4254278                Kingsway  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4299526 4299526  Southeast Marine Drive  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4323332 4323332            Yukon Street  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4323338 4323338         West 7th Avenue  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
## 4360742 4360742        Brunswick Street  &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;             &lt;NA&gt;
##         addr.postcode addr.street alt_name amenity area area.highway
## 4231647          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4231648          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4231651          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4231652          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4241338          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4254278          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4299526          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4323332          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4323338          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
## 4360742          &lt;NA&gt;        &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
##         attribution barrier bicycle boundary bridge bridge.name
## 4231647        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4231648        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4231651        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4231652        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4241338        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4254278        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4299526        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4323332        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4323338        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
## 4360742        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;        &lt;NA&gt;
##         bridge.structure bridge_name bridge_name.en bridge_name.fr building
## 4231647             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4231648             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4231651             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4231652             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4241338             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4254278             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4299526             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4323332             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4323338             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
## 4360742             &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;
##         building.levels  bus bus.lanes busway button_operated canvec.CODE  car
## 4231647            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4231648            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4231651            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4231652            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4241338            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4254278            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4299526            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4323332            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4323338            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
## 4360742            &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;            &lt;NA&gt;        &lt;NA&gt; &lt;NA&gt;
##         change.lanes.backward change.lanes.forward construction covered
## 4231647                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4231648                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4231651                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4231652                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4241338                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4254278                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4299526                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4323332                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4323338                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
## 4360742                  &lt;NA&gt;                 &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;
##         created_by crossing crossing.island cutting cycleway cycleway.both
## 4231647       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4231648       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4231651       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4231652       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4241338       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;            no
## 4254278       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4299526       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4323332       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4323338       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
## 4360742       &lt;NA&gt;     &lt;NA&gt;            &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;
##         cycleway.left cycleway.right description description.bicycle
## 4231647          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4231648          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4231651          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4231652          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4241338          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4254278          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4299526          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4323332          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4323338          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
## 4360742          &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;                &lt;NA&gt;
##         destination destination.backward destination.forward destination.lanes
## 4231647        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4231648        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4231651        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4231652        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4241338        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4254278        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4299526        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4323332        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4323338        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4360742        &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
##         destination.ref destination.ref.lanes destination.ref.to
## 4231647            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4231648            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4231651            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4231652            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4241338            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4254278            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4299526            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4323332            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4323338            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
## 4360742            &lt;NA&gt;                  &lt;NA&gt;               &lt;NA&gt;
##         destination.street destination.symbol direction  dog dogs embankment
## 4231647               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231648               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231651               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231652               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4241338               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4254278               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4299526               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4323332               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4323338               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4360742               &lt;NA&gt;               &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
##         est_width except fixme floating foot footway
## 4231647      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4231648      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4231651      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4231652      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4241338      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4254278      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   no    &lt;NA&gt;
## 4299526      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4323332      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4323338      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
## 4360742      &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;
##         geobase.acquisitionTechnique geobase.datasetName geobase.uuid golf
## 4231647                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4231648                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4231651                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4231652                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4241338                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4254278                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4299526                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4323332                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4323338                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
## 4360742                         &lt;NA&gt;                &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;
##         golf_cart handrail hazmat height  hgv      highway historic horse
## 4231647      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;    secondary     &lt;NA&gt;  &lt;NA&gt;
## 4231648      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;        trunk     &lt;NA&gt;  &lt;NA&gt;
## 4231651      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;   no    secondary     &lt;NA&gt;  &lt;NA&gt;
## 4231652      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;   no    secondary     &lt;NA&gt;  &lt;NA&gt;
## 4241338      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;      primary     &lt;NA&gt;  &lt;NA&gt;
## 4254278      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;      primary     &lt;NA&gt;  &lt;NA&gt;
## 4299526      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;   no     tertiary     &lt;NA&gt;  &lt;NA&gt;
## 4323332      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt; unclassified     &lt;NA&gt;  &lt;NA&gt;
## 4323338      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;     tertiary     &lt;NA&gt;  &lt;NA&gt;
## 4360742      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  residential     &lt;NA&gt;  &lt;NA&gt;
##         hov.lanes hov.minimum incline indoor informal information
## 4231647      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4231648      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4231651      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4231652      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4241338      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4254278      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4299526      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4323332      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4323338      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
## 4360742      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;
##         internet_access internet_access.fee                       is_in
## 4231647            &lt;NA&gt;                &lt;NA&gt; Vancouver, British Columbia
## 4231648            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4231651            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4231652            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4241338            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4254278            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4299526            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4323332            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4323338            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
## 4360742            &lt;NA&gt;                &lt;NA&gt;                        &lt;NA&gt;
##         junction junction.ref kerb landuse lanes lanes.backward lanes.bus
## 4231647     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;     1           &lt;NA&gt;      &lt;NA&gt;
## 4231648     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;     6           &lt;NA&gt;      &lt;NA&gt;
## 4231651     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4231652     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4241338     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4254278     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;     2           &lt;NA&gt;      &lt;NA&gt;
## 4299526     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4323332     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4323338     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
## 4360742     &lt;NA&gt;         &lt;NA&gt; &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;
##         lanes.bus.backward lanes.bus.backward.conditional lanes.bus.conditional
## 4231647               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4231648               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4231651               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4231652               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4241338               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4254278               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4299526               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4323332               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4323338               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
## 4360742               &lt;NA&gt;                           &lt;NA&gt;                  &lt;NA&gt;
##         lanes.bus.forward lanes.bus.forward.conditional lanes.forward layer
## 4231647              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4231648              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4231651              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4231652              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4241338              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4254278              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4299526              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4323332              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4323338              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
## 4360742              &lt;NA&gt;                          &lt;NA&gt;          &lt;NA&gt;  &lt;NA&gt;
##          lcn lcn_ref leisure level line  lit loc_name location man_made
## 4231647 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231648 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231651 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231652 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4241338 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4254278 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4299526 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4323332 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4323338 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4360742 &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
##         maxheight maxspeed maxspeed.advisory maxspeed.conditional maxspeed.type
## 4231647      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4231648      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4231651      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4231652      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4241338      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4254278      &lt;NA&gt;       50              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4299526      &lt;NA&gt;     &lt;NA&gt;              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4323332      &lt;NA&gt;     &lt;NA&gt;              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4323338      &lt;NA&gt;     &lt;NA&gt;              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
## 4360742      &lt;NA&gt;     &lt;NA&gt;              &lt;NA&gt;                 &lt;NA&gt;          &lt;NA&gt;
##         maxweight min_height motor_vehicle motor_vehicle.lanes motorcar
## 4231647      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4231648      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4231651      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4231652      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4241338      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4254278      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4299526      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4323332      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4323338      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
## 4360742      &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;                &lt;NA&gt;     &lt;NA&gt;
##         motorcycle motorcycle.lanes  mtb mtb.scale name.en name.fr name.zh
## 4231647       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4231648       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4231651       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4231652       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4241338       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4254278       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4299526       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4323332       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4323338       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
## 4360742       &lt;NA&gt;             &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;
##         natural network noexit noname note note1 note.bicycle note_2 odbl
## 4231647    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4231648    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4231651    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4231652    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4241338    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4254278    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4299526    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4323332    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4323338    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
## 4360742    &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;
##         official_name old_railway_operator old_ref oneway oneway.bicycle
## 4231647          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;    yes           &lt;NA&gt;
## 4231648          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;     no           &lt;NA&gt;
## 4231651          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;     no           &lt;NA&gt;
## 4231652          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;     no           &lt;NA&gt;
## 4241338          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;     no           &lt;NA&gt;
## 4254278          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;    yes           &lt;NA&gt;
## 4299526          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;
## 4323332          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;    yes           &lt;NA&gt;
## 4323338          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;
## 4360742          &lt;NA&gt;                 &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;
##         opening_hours operator parking.condition.both parking.condition.left
## 4231647          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4231648          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4231651          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4231652          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4241338          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4254278          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4299526          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4323332          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4323338          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
## 4360742          &lt;NA&gt;     &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt;
##         parking.condition.left.time_interval parking.condition.right
## 4231647                                 &lt;NA&gt;                    &lt;NA&gt;
## 4231648                                 &lt;NA&gt;                    &lt;NA&gt;
## 4231651                                 &lt;NA&gt;                    &lt;NA&gt;
## 4231652                                 &lt;NA&gt;                    &lt;NA&gt;
## 4241338                                 &lt;NA&gt;                    &lt;NA&gt;
## 4254278                                 &lt;NA&gt;                    &lt;NA&gt;
## 4299526                                 &lt;NA&gt;                    &lt;NA&gt;
## 4323332                                 &lt;NA&gt;                    &lt;NA&gt;
## 4323338                                 &lt;NA&gt;                    &lt;NA&gt;
## 4360742                                 &lt;NA&gt;                    &lt;NA&gt;
##         parking.lane.both parking.lane.left parking.lane.right phone pier place
## 4231647              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4231648              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4231651              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4231652              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4241338              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4254278              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4299526              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4323332              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4323338              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
## 4360742              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;
##         postal_code private  psv public_transport railway ramp ramp_speed
## 4231647        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231648        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231651        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4231652        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4241338        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4254278        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4299526        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4323332        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4323338        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
## 4360742        &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;
##            ref reg_name restriction rollerblades rollerblading roof.direction
## 4231647   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4231648     99     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4231651   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4231652   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4241338      7     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4254278 1A;99A     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4299526   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4323332   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4323338   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
## 4360742   &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;
##         roof.height roof.shape route sac_scale school_zone scooter seasonal
## 4231647        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4231648        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4231651        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4231652        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4241338        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4254278        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4299526        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4323332        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4323338        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
## 4360742        &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;        &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;
##         segregated service shop short_name shoulder sidewalk
## 4231647       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231648       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231651       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4231652       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4241338       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt; separate
## 4254278       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4299526       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4323332       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4323338       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
## 4360742       &lt;NA&gt;    &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;
##         sidewalk.both.surface sidewalk.left sidewalk.left.surface
## 4231647                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4231648                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4231651                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4231652                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4241338                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4254278                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4299526                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4323332                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4323338                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
## 4360742                  &lt;NA&gt;          &lt;NA&gt;                  &lt;NA&gt;
##         sidewalk.left.width sidewalk.right skateboard smoothness source source1
## 4231647                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4231648                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4231651                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4231652                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4241338                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4254278                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4299526                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4323332                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4323338                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
## 4360742                &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;
##         source.bicycle source.bridge source.highway source.location
## 4231647           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4231648           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4231651           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4231652           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4241338           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4254278           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4299526           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4323332           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4323338           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
## 4360742           &lt;NA&gt;          &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;
##         source.maxspeed source.parking sport stairs step_count surface
## 4231647            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4231648            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4231651            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4231652            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;
## 4241338            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4254278            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4299526            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;
## 4323332            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; asphalt
## 4323338            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;
## 4360742            &lt;NA&gt;           &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;
##         swimming_pool tactile_paving tracktype traffic_calming traffic_signals
## 4231647          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4231648          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4231651          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4231652          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4241338          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4254278          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4299526          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4323332          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4323338          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
## 4360742          &lt;NA&gt;           &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
##         trail_visibility train transit.lanes trolley_wire trolleybus tunnel
## 4231647             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4231648             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;          yes       &lt;NA&gt;   &lt;NA&gt;
## 4231651             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4231652             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4241338             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;          yes       &lt;NA&gt;   &lt;NA&gt;
## 4254278             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;          yes       &lt;NA&gt;   &lt;NA&gt;
## 4299526             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4323332             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4323338             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
## 4360742             &lt;NA&gt;  &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
##         tunnel.name turn turn.lanes turn.lanes.backward turn.lanes.forward type
## 4231647        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4231648        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4231651        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4231652        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4241338        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4254278        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4299526        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4323332        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4323338        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
## 4360742        &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt; &lt;NA&gt;
##          url vehicle water website wheelchair width wikidata wikipedia
## 4231647 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4231648 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4231651 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4231652 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4241338 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4254278 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4299526 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4323332 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4323338 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
## 4360742 &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;
##                               geometry    length
## 4231647 LINESTRING (487783.5 545504... 675.56731
## 4231648 LINESTRING (489796.3 545191... 785.18375
## 4231651 LINESTRING (492986.4 545634... 384.13004
## 4231652 LINESTRING (495520.8 545630... 408.83511
## 4241338 LINESTRING (492368.1 545669... 139.49219
## 4254278 LINESTRING (492654.2 545687...  37.67748
## 4299526 LINESTRING (497162.2 545055...  12.39348
## 4323332 LINESTRING (491801.3 545718...  37.92632
## 4323338 LINESTRING (492373.3 545688... 584.28177
## 4360742 LINESTRING (492939.7 545667... 442.83200</code></pre>
<p>As you can see we can access the <code>sf</code></p>
<pre class="r"><code>lixel_list_25m &lt;- lixelize_network(
  sf_network = network_sln@sl,
  max_lixel_length = 25,
  uid = &quot;osm_id&quot;
    
)</code></pre>
<pre><code>## [1] &quot;Splitting input spatial lines by lixel length...&quot;
## [1] &quot;Create corresponding shortest distance network...&quot;</code></pre>
</div>
<div id="prepare-the-point-data" class="section level1">
<h1>Prepare the point data</h1>
<p>Here I need to ensure that the point data are lined up with the network data in geographic space. I use a function called <code>st_snap_points</code>. The function is given below:</p>
<pre class="r"><code>st_snap_points = function(x, y, max_dist = 1000) {
  
  if (inherits(x, &quot;sf&quot;)) n = nrow(x)
  if (inherits(x, &quot;sfc&quot;)) n = length(x)
  
  out = do.call(c,
                lapply(seq(n), function(i) {
                  nrst = st_nearest_points(st_geometry(x)[i], y)
                  nrst_len = st_length(nrst)
                  nrst_mn = which.min(nrst_len)
                  if (as.vector(nrst_len[nrst_mn]) &gt; max_dist) return(st_geometry(x)[i])
                  return(st_cast(nrst[nrst_mn], &quot;POINT&quot;)[2])
                })
  )
  return(out)
}</code></pre>
<p>We snap the points to our road network with a 20m tolerance.</p>
<pre class="r"><code>coll_snp &lt;- st_snap_points(collisions,network_sln@sl,max_dist = 20)
coll_snp &lt;- st_sf(collisions %&gt;%
                  st_drop_geometry() %&gt;%
                  mutate(geom=coll_snp))</code></pre>
</div>
<div id="calculate-network-kernel-density" class="section level1">
<h1>Calculate Network Kernel Density</h1>
<ul>
<li>Add more detail here</li>
</ul>
<pre class="r"><code>st_line_midpoints &lt;- function(sf_lines = NULL) {
  
  g &lt;- st_geometry(sf_lines)
  
  g_mids &lt;- lapply(g, function(x) {
    
    coords &lt;- as.matrix(x)
    
    # this is just a copypaste of View(maptools:::getMidpoints):
    get_mids &lt;- function (coords) {
      dist &lt;- sqrt((diff(coords[, 1])^2 + (diff(coords[, 2]))^2))
      dist_mid &lt;- sum(dist)/2
      dist_cum &lt;- c(0, cumsum(dist))
      end_index &lt;- which(dist_cum &gt; dist_mid)[1]
      start_index &lt;- end_index - 1
      start &lt;- coords[start_index, ]
      end &lt;- coords[end_index, ]
      dist_remaining &lt;- dist_mid - dist_cum[start_index]
      mid &lt;- start + (end - start) * (dist_remaining/dist[start_index])
      return(mid)
    }
    
    mids &lt;- st_point(get_mids(coords))
  })
  
  out &lt;- st_sfc(g_mids, crs = st_crs(sf_lines))
  out &lt;- st_sf(out)
  out &lt;- bind_cols(out,sf_lines %&gt;% st_drop_geometry()) %&gt;% rename(geom=out)
}


network_kde &lt;- function(lixel_list,point_process,bandwidth = 100,n_cores=1,attribute=1,point_process_is_lixel_midpoint=FALSE){
  #1. Create segement base linear reference system from original road network

  #Done outside function using &quot;lixelize_network&quot;

  #2. Divide each segment in basic linear units of defined length (lixel_length)

  #Done outside function using &quot;lixelize_network&quot;
  #Our approach varies from Xie and Yan (2008) in that we define a &quot;maximum&quot; length for lixels, and  segments that are larger than the specified length
  #are split into equal sized lixels. Instead of having x lixels with 1 extra &quot;residual lixel&quot; we instead have x+1 lixels of equal length, under the lixel limit
  #E.g. a 45 lixel with a maximum lixel length of 10m  would be split into 5 segments of 9m instead of 4 lixels of 10m and a residual lixel of 5m.

  #3. Create a network of lixels by establishing the network topology between lixels as well as between lixels and lxnodes.

  #Define topology for calculating shortest distances by converting lixel with half the length to calculate distances
  #The shorter the lixel length the more accurate the calculation of network distance from nearest node of source lixel to nearest node of target lixel
  print(&quot;Defining network topology...&quot;)
  
  require(parallel)
  require(doParallel)
  require(igraph)
  require(tidygraph)
  require(sf)  
  require(dplyr)


  # Create nodes at the start and end point of each edge

  nodes &lt;- lixel_list$shortest_distance_network %&gt;%
    st_coordinates() %&gt;%
    as_tibble() %&gt;%
    rename(LIXID = L1) %&gt;%
    group_by(LIXID) %&gt;%
    slice(c(1, n())) %&gt;%
    ungroup() %&gt;%
    mutate(start_end = rep(c(&#39;start&#39;, &#39;end&#39;), times = n()/2))

  # Give each node a unique index

  nodes &lt;- nodes %&gt;%
    mutate(xy = paste(.$X, .$Y),
           xy = factor(xy, levels = unique(xy))) %&gt;%
    group_by(xy)%&gt;%
    mutate(nodeID = cur_group_id()) %&gt;%
    ungroup() %&gt;%
    select(-xy)

  # Combine the node indices with the edges

  start_nodes &lt;- nodes %&gt;%
    filter(start_end == &#39;start&#39;) %&gt;%
    pull(nodeID)

  end_nodes &lt;- nodes %&gt;%
    filter(start_end == &#39;end&#39;) %&gt;%
    pull(nodeID)

  lixel_list$shortest_distance_network = lixel_list$shortest_distance_network %&gt;%
    mutate(from = start_nodes, to = end_nodes)

  # Remove duplicate nodes
  nodes &lt;- nodes %&gt;%
    distinct(nodeID, .keep_all = TRUE) %&gt;%
    select(-c(LIXID, start_end)) %&gt;%
    st_as_sf(coords = c(&#39;X&#39;, &#39;Y&#39;)) %&gt;%
    st_set_crs(st_crs(lixel_list$shortest_distance_network))

  # Convert to tbl_graph
  graph &lt;- tbl_graph(nodes = nodes, edges = as_tibble(lixel_list$shortest_distance_network), directed = FALSE)

  graph &lt;- graph %&gt;%
    activate(edges) %&gt;%
    mutate(length = st_length(geometry))

  lixel_list$shortest_distance_network &lt;- NULL

  #4. Create the center points of all the lixels for the target lixel (lxcenters)
  print(&quot;Calculating lixel midpoints (lxcenters)...&quot;)

  lxcenters &lt;- st_line_midpoints(lixel_list$target_lixel)

  #5. Select a point process occurring within the road network

  #input as function parameter

  #6. For each point find its nearest lixel. Count the number of points nearest to a lixel and assigned as property of lixel.

  #Points should be snapped to network within some distance threshold prior to

  if(point_process_is_lixel_midpoint==FALSE){

  print(&quot;Counting number of events on each lixel...&quot;)

  point_process &lt;- st_join(point_process,lixel_list$target_lixel[&quot;LIXID&quot;],
                           join = st_is_within_distance, dist = 0.001) #for each point assign the LIXID that it falls on

  source_lixels &lt;- point_process %&gt;% #summarize the number of points by LIXID (e.g. count the points for each LIXID)
    filter(!is.na(LIXID)) %&gt;%
    group_by(LIXID) %&gt;%
    summarise(n_events = n(),`.groups`=&quot;drop&quot;) %&gt;%
    st_drop_geometry()

  source_lixels &lt;- inner_join(lxcenters,source_lixels,by=&quot;LIXID&quot;) #define geometry for source lixels
  }

  if(point_process_is_lixel_midpoint==TRUE){

    source_lixels &lt;- lxcenters %&gt;% mutate(n_events = 1)
  }

  print(paste0(sum(source_lixels$n_events),&quot; events on &quot;,nrow(source_lixels),&quot; source lixels&quot;))

  #7. Define a search bandwidth, measured with the short path network distance

  #input as function parameter

  #8. Calculate the shortest-path network distance from each source lixel to lxcenter of all its neighouring lixels within the seach bandwidth


  nearest_node_to_source_lixel &lt;- st_nearest_feature(source_lixels,nodes)#find nodes from shortest distance network associated with each source lixel
  nearest_node_to_lxcentre &lt;- st_nearest_feature(lxcenters,nodes)#find nodes from shortest distance network associated with each lxcenters

  print(&quot;Calculating distances from each source lixel to all other lixel centers... &quot;)
  

  cl &lt;- makeCluster(n_cores)
  registerDoParallel(cores=cl) #parallel computing

  distances &lt;- foreach::foreach(i = 1:length(nearest_node_to_source_lixel),.packages = c(&quot;magrittr&quot;,&quot;igraph&quot;,&quot;tidygraph&quot;,&quot;sf&quot;)) %dopar% {
    temp &lt;- distances(
      graph = graph,
      weights = graph %&gt;% activate(edges) %&gt;% pull(length),
      v = nearest_node_to_source_lixel[i]
    )[,nearest_node_to_lxcentre]

    data.frame(LIXID = lxcenters[temp&lt;=max(bandwidth),]$LIXID,
               dist = temp[temp&lt;=max(bandwidth)])
  }

 stopCluster(cl)

  rm(&quot;graph&quot;)


  # gauss &lt;-function(x) {
  #
  #   t1 &lt;- 1/(sqrt(2*pi))
  #   t2 &lt;- exp(-((x^2)/(2*bandwidth^2)))
  #   n &lt;- (1/bandwidth)*(t1*t2)
  #   n &lt;- ifelse(x&gt;bandwidth,0,n)
  #
  #
  #   return(n)
  #
  # }
  #
  # plot(gauss(0:(bandwidth*2)))

  quartic &lt;-function(x,r) {
    K &lt;- 3/pi
    t1 &lt;- 1-(x^2/r^2)
    q &lt;- ifelse(x&gt;r,0,K*t1)
    q &lt;- (1/r)*q

    return(q)
  }

  LIXID &lt;- unlist(lapply(lapply(distances,`[`,&quot;LIXID&quot;),function(x) pull(x)))
  distances_list &lt;- lapply(lapply(distances,`[`,&quot;dist&quot;),function(x) pull(x))

  d_list &lt;- list()

  for(i in 1:length(bandwidth)){

    print(paste0(&quot;Applying kernel density estimator with bandwidth of &quot;,bandwidth[i],&quot;m ... &quot;))

    d &lt;- lapply(distances_list,function(x) quartic(x,bandwidth[i]))
    d &lt;- mapply(`*`,d,attribute) #multiply by attribute of source lixel
    d &lt;- mapply(`*`,d,source_lixels$n_events) #sum over number of events that occured on the source lixel

    d_list[[i]] &lt;- data.frame(unlist(d))
  }

  d_cols &lt;- as.data.frame(do.call(cbind,d_list))

  names(d_cols) &lt;- paste0(&quot;kde_bw_&quot;,bandwidth)

  #sum densities over all lixels
  density &lt;- cbind(LIXID,d_cols) %&gt;%
    group_by(LIXID) %&gt;%
    summarise(across(everything(),sum),`.groups`=&quot;drop&quot;)

  network_kde &lt;- left_join(lixel_list$target_lixel,density,by = &quot;LIXID&quot;) %&gt;%
    mutate(length = st_length(.)) %&gt;%
    replace(., is.na(.), 0)

  return(list(network_kde=network_kde,neighbours = distances))

}</code></pre>
<p>Parallel computing to speed up the process - list packages and stuff</p>
<ul>
<li>describe parameters heren - bandwidth etc.</li>
</ul>
<pre class="r"><code>n_cores &lt;- bigstatsr::nb_cores()

#KDE for BikeMaps incidents

system.time({
  collisions_network_kde &lt;- network_kde(lixel_list = lixel_list_25m,
                                 point_process = coll_snp,
                                 bandwidth = c(50,100,150,250),
                                 n_cores = n_cores,
                                 point_process_is_lixel_midpoint = FALSE)
})</code></pre>
<pre><code>## [1] &quot;Defining network topology...&quot;</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## Loading required package: doParallel</code></pre>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## Loading required package: iterators</code></pre>
<pre><code>## [1] &quot;Calculating lixel midpoints (lxcenters)...&quot;
## [1] &quot;Counting number of events on each lixel...&quot;
## [1] &quot;1461 events on 1036 source lixels&quot;
## [1] &quot;Calculating distances from each source lixel to all other lixel centers... &quot;
## [1] &quot;Applying kernel density estimator with bandwidth of 50m ... &quot;
## [1] &quot;Applying kernel density estimator with bandwidth of 100m ... &quot;
## [1] &quot;Applying kernel density estimator with bandwidth of 150m ... &quot;
## [1] &quot;Applying kernel density estimator with bandwidth of 250m ... &quot;</code></pre>
<pre><code>##    user  system elapsed 
##   98.09    1.01  165.00</code></pre>
<pre class="r"><code>collisions_network_kde$network_kde</code></pre>
<pre><code>## Simple feature collection with 61763 features and 7 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 482364.1 ymin: 5449003 xmax: 498834.3 ymax: 5463459
## projected CRS:  NAD83 / UTM zone 10N
## First 10 features:
##     osm_id LIXID   kde_bw_50  kde_bw_100   kde_bw_150  kde_bw_250
## 1  4231647     1 0.015901514 0.009149662 0.0062477874 0.003794142
## 2  4231647     2 0.003913026 0.007651101 0.0058037693 0.003698234
## 3  4231647     3 0.000000000 0.005040750 0.0050303321 0.003531172
## 4  4231647     4 0.000000000 0.001318610 0.0039274758 0.003292955
## 5  4231647     5 0.000000000 0.000000000 0.0024952004 0.002983583
## 6  4231647     6 0.000000000 0.000000000 0.0007335059 0.002865049
## 7  4231647     7 0.000000000 0.000000000 0.0000000000 0.003089337
## 8  4231647     8 0.000000000 0.000000000 0.0000000000 0.003171315
## 9  4231647     9 0.000000000 0.000000000 0.0000000000 0.003110985
## 10 4231647    10 0.000000000 0.000000000 0.0004366537 0.002908345
##                          geometry      length
## 1  LINESTRING (487783.5 545504... 24.1274 [m]
## 2  LINESTRING (487806.9 545504... 24.1274 [m]
## 3  LINESTRING (487830.9 545503... 24.1274 [m]
## 4  LINESTRING (487855 5455038,... 24.1274 [m]
## 5  LINESTRING (487879.1 545503... 24.1274 [m]
## 6  LINESTRING (487903.2 545503... 24.1274 [m]
## 7  LINESTRING (487927.4 545503... 24.1274 [m]
## 8  LINESTRING (487951.5 545503... 24.1274 [m]
## 9  LINESTRING (487975.6 545503... 24.1274 [m]
## 10 LINESTRING (487999.8 545503... 24.1274 [m]</code></pre>
<p>Here is the map of kernedl density “hotspots” for the entire city</p>
<pre class="r"><code>ggplot() +
  geom_sf(data=study_area,color=NA,fill=&quot;gray5&quot;)+
  geom_sf(data = collisions_network_kde$network_kde,aes(color=kde_bw_150))+
  scale_color_viridis_c(option = &quot;C&quot;,direction = 1,name=&quot;Density&quot;) + 
  # geom_sf(data=mask,color=NA,fill=&quot;white&quot;)+
  theme_void()+
  theme(panel.background= element_rect(fill = NA,color=NA),
        legend.position = &quot;top&quot;,
        legend.title.align = 0,
        legend.key.size = unit(1, &#39;cm&#39;), #change legend key size
        legend.key.height = unit(0.5, &#39;cm&#39;), #change legend key height
        legend.key.width = unit(1.5, &#39;cm&#39;))+
  coord_sf(xlim = c(483690.9,499329.2),
           ylim = c(5450534.8,5463381.0))</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Zoomed into downtown area</p>
<pre class="r"><code>ggplot() +
  geom_sf(data=study_area,color=NA,fill=&quot;gray5&quot;)+
  geom_sf(data = collisions_network_kde$network_kde,aes(color=kde_bw_150))+
  scale_color_viridis_c(option = &quot;C&quot;,direction = 1,name=&quot;Density&quot;) + 
  theme_void()+
  theme(panel.background= element_rect(fill = NA,color=NA),
        legend.position = &quot;top&quot;,
        legend.title.align = 0,
        legend.key.size = unit(1, &#39;cm&#39;), #change legend key size
        legend.key.height = unit(0.5, &#39;cm&#39;), #change legend key height
        legend.key.width = unit(1.5, &#39;cm&#39;))+
  coord_sf(xlim = c(491321.39853389-1000,491321.39853389+1000),
           ylim = c(5459015.689874-1000,5459015.689874+1000))</code></pre>
<p><img src="/post/kernel-density-estimation-in-network-space/index.en_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>```</p>
</div>
